<html>
    <head>
        <!-- Importation des networks et graph2d de Vis -->
        <script src="https://unpkg.com/vis-network/standalone/umd/vis-network.min.js"></script>
        <script type="text/javascript" src="https://unpkg.com/vis-timeline@latest/standalone/umd/vis-timeline-graph2d.min.js"></script>

        <!-- Latest compiled and minified CSS -->
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">

        <!-- Optional theme -->
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap-theme.min.css" integrity="sha384-rHyoN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp" crossorigin="anonymous">

        <!-- jQuery -->
        <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>

        <!-- Latest compiled and minified JavaScript -->
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

        <script>
            var nodes = { "o": [
                                {
                                "friendlyName": "Michael",
                                "sshParameters": {
                                    "port": 22,
                                    "timeoutS": 10
                                },
                                "inetAddresses": [],
                                "webServers": [],
                                "servicesStrings": [],
                                "neighbors": [
                                    {
                                    "id": "Jessica",
                                    "latency": 1.0,
                                    "rate": 1
                                    },
                                    {
                                    "id": "Christopher",
                                    "latency": 1.0,
                                    "rate": 1
                                    },
                                    {
                                    "id": "Matthew",
                                    "latency": 1.0,
                                    "rate": 1
                                    }
                                ]
                                },
                                {
                                "friendlyName": "Christopher",
                                "sshParameters": {
                                    "port": 22,
                                    "timeoutS": 10
                                },
                                "inetAddresses": [],
                                "webServers": [],
                                "servicesStrings": [],
                                "neighbors": [
                                    {
                                    "id": "Michael",
                                    "latency": 1.0,
                                    "rate": 1
                                    },
                                    {
                                    "id": "Ashley",
                                    "latency": 1.0,
                                    "rate": 1
                                    },
                                    {
                                    "id": "Jessica",
                                    "latency": 1.0,
                                    "rate": 1
                                    }
                                ]
                                },
                                {
                                "friendlyName": "Jessica",
                                "sshParameters": {
                                    "port": 22,
                                    "timeoutS": 10
                                },
                                "inetAddresses": [],
                                "webServers": [],
                                "servicesStrings": [],
                                "neighbors": [
                                    {
                                    "id": "Jessica",
                                    "latency": 1.0,
                                    "rate": 1
                                    },
                                    {
                                    "id": "Jessica",
                                    "latency": 1.0,
                                    "rate": 1
                                    },
                                    {
                                    "id": "Christopher",
                                    "latency": 1.0,
                                    "rate": 1
                                    }
                                ]
                                },
                                {
                                "friendlyName": "Matthew",
                                "sshParameters": {
                                    "port": 22,
                                    "timeoutS": 10
                                },
                                "inetAddresses": [],
                                "webServers": [],
                                "servicesStrings": [],
                                "neighbors": [
                                    {
                                    "id": "Matthew",
                                    "latency": 1.0,
                                    "rate": 1
                                    },
                                    {
                                    "id": "Ashley",
                                    "latency": 1.0,
                                    "rate": 1
                                    },
                                    {
                                    "id": "Christopher",
                                    "latency": 1.0,
                                    "rate": 1
                                    }
                                ]
                                },
                                {
                                "friendlyName": "Ashley",
                                "sshParameters": {
                                    "port": 22,
                                    "timeoutS": 10
                                },
                                "inetAddresses": [],
                                "webServers": [],
                                "servicesStrings": [],
                                "neighbors": [
                                    {
                                    "id": "Matthew",
                                    "latency": 1.0,
                                    "rate": 1
                                    },
                                    {
                                    "id": "Matthew",
                                    "latency": 1.0,
                                    "rate": 1
                                    },
                                    {
                                    "id": "Ashley",
                                    "latency": 1.0,
                                    "rate": 1
                                    }
                                ]
                                }
                            ]
                            }

            console.log(nodes.o)
            class Node {
                constructor (id, label) {
                    this.id = id;
                    this.label = label;
                    this.contacts = [];
                    console.log(this);
                }

                linkTo (node) {
                    if (this.contacts.includes(node)) {
                        return false;
                    }
                    this.contacts.push(node);
                }

                getNode () {
                    return {
                        id: this.id,
                        label: this.label
                    }
                }

                getContacts () {
                    let res = [];
                    this.contacts.forEach ((contact) => {
                        res.push ({
                            from: this.id,
                            to: contact.id
                        });
                    });
                    return res;
                }
            }

            class Network {
                constructor () {
                    this.listNodes = [];
                }

                addNode (label) {
                    let ID;
                    this.listNodes.length > 0 ? ID = this.listNodes[this.listNodes.length -1].id + 1 : ID = 0;
                    let newNode = new Node (ID, label);
                    this.listNodes.push(newNode);
                    return newNode;
                }

                linkNode (from, to) {
                    from.linkTo (to);
                }

                getNode (ID) {
                    let res = null;
                    this.listNodes.forEach ((node) => {
                        if (node.id == ID) {
                            res = node;
                        }
                    })
                    return res;
                }

                getIdFromLabel (name) {
                    let res = null;
                    this.listNodes.forEach ((node) => {
                        if (node.label == name) {
                            res = node;
                        }
                    });
                    return res;
                }

                getData () {
                    let data = [];
                    let link = [];
                    this.listNodes.forEach ((node) => {
                        data.push(node.getNode ());
                        if (node.getContacts ().length > 0) {
                            link = link.concat(node.getContacts ());
                        }
                    });
                    console.log(data, link);
                    return {
                        nodes: new vis.DataSet(data),
                        edges: new vis.DataSet(link)
                    }
                }
            }

            window.addEventListener ("load", (event) => {
                let network = new Network ();

                // remplissage de la balise select à partir du JSON

                nodes.o.forEach((n) => {
                    let option = document.createElement ("option");
                    option.innerHTML = n.friendlyName;
                    document.querySelector ("#select-machines").appendChild (option);

                    // let div = $("#dropdown-machines")
                    //             .append($("<a></a>"))
                    //             .text(n.friendlyName)
                    //             .attr({
                    //                 class: "dropdown-item",
                    //                 href: "#"
                    //             });

                    let div = $("#list-machine");
                    div.append($("<li></li>")
                        .text(n.friendlyName)
                        .attr({
                            class: "list-group-item"
                        }));
                });

                // création du graphique network à partir du JSON

                nodes.o.forEach((n) => {
                    network.addNode (n.friendlyName);
                });

                nodes.o.forEach((n) => {
                    n.neighbors.forEach((voisin) => {
                        network.linkNode (network.getIdFromLabel (n.friendlyName), network.getIdFromLabel (voisin.id));
                    });
                });

                createNetwork (document.querySelector ("#reseau-machine"), network.getData ());

                // création du graphique courbe à partir du JSON
                var items = [];
                for (let jours=11; jours <= 18; jours++) {
                    for (let heures=0; heures < 24; heures++) {
                        let transformH = "";
                        (heures < 10) ? transformH = "0" + heures : transformH = "" + heures;
                        items.push({
                            x: "2020-12-" + jours + "T" + transformH + ":00:00", 
                            y:  Math.floor(Math.random() * Math.floor(100)),
                            group: 0
                        })
                    }
                }

                var groups = new vis.DataSet ();
                let index = 0;
                
                nodes.o.forEach((n) => {
                    groups.add({
                        id: index,
                        content: n.friendlyName,
                        className: "custom-style" + (index + 1),
                        options: {
                            drawPoints: {
                                    style: "square", // square, circle
                                },
                                shaded: {
                                    orientation: "bottom", // top, bottom
                                },
                            }
                        });
                    index++;
                });
                let options = {
                    dataAxis: {
                        showMinorLabels: false,
                        right: {
                            title: {
                                text: "Title (right axis)",
                            },
                        },
                    },
                    legend: { left: { position: "bottom-left" } },
                    start: "2020-12-11",
                    end: "2020-12-18",
                };


                var graph2d = new vis.Graph2d($("#message-machine").get(0), (items), groups, options);
            });

            function createNetwork (container, data, options={}, width=400, height=400) {
                main = document.createElement ("div");
                main.style.width = width+"px";
                main.style.height = height+"px";
                container.appendChild (main);

                return new vis.Network (main, data, options);
            }
        </script>
    </head>


    <body>
        <h1>Bienvenue</h1>
        <button type="button" class="btn btn-primary">Primary</button>
        <button type="button" class="btn btn-secondary">Secondary</button>
        <button type="button" class="btn btn-success">Success</button>
        <button type="button" class="btn btn-danger">Danger</button>
        <button type="button" class="btn btn-warning">Warning</button>
        <button type="button" class="btn btn-info">Info</button>
        <button type="button" class="btn btn-light">Light</button>
        <button type="button" class="btn btn-dark">Dark</button>
        
        <button type="button" class="btn btn-link">Link</button>

        <div class="input-group col-sm-5">
            <span class="input-group-addon">Machines</span>
            <select id="select-machines" class="form-control"></select>
        </div>
        

        <!-- <div class="dropdown">
            <button class="btn btn-secondary dropdown-toggle" type="button" id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
              Machines
            </button>
            <div id="dropdown-machines" class="dropdown-menu" aria-labelledby="dropdownMenuButton">
              <a class="dropdown-item" href="#">Action</a>
              <a class="dropdown-item" href="#">Another action</a>
              <a class="dropdown-item" href="#">Something else here</a>
            </div>
        </div> -->

        <ul id="list-machine" class="list-group">
        </ul>

        <p>Affichage du nombre de messages reçu par cette machine ces 7 derniers jours :</p>
        <div id="message-machine"></div>
        
        <p>Affichage du réseaux :</p>
        <div id="reseau-machine"></div>

    </body>
</html>